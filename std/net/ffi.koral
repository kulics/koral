// ============================================================================
// std.net - FFI Declarations (shared by tcp_listener, tcp_socket, udp_socket)
// ============================================================================

/// Create a socket (returns fd or -1 on error)
foreign let __koral_socket_create(domain Int32, sock_type Int32, protocol Int32) Int64

/// Close a socket
foreign let __koral_socket_close(fd Int64) Int32

/// Bind a socket to an address
foreign let __koral_socket_bind(fd Int64, addr UInt8 ptr, addr_len UInt32) Int32

/// Start listening for connections
foreign let __koral_socket_listen(fd Int64, backlog Int32) Int32

/// Accept a connection (returns new fd or -1 on error)
foreign let __koral_socket_accept(fd Int64, addr_out UInt8 ptr, addr_len_out UInt32 ptr) Int64

/// Connect to a remote address
foreign let __koral_socket_connect(fd Int64, addr UInt8 ptr, addr_len UInt32) Int32

/// Send data
foreign let __koral_socket_send(fd Int64, buf UInt8 ptr, len UInt64, flags Int32) Int64

/// Receive data
foreign let __koral_socket_recv(fd Int64, buf UInt8 ptr, len UInt64, flags Int32) Int64

/// Send data to a specific address (UDP)
foreign let __koral_socket_sendto(fd Int64, buf UInt8 ptr, len UInt64, flags Int32, addr UInt8 ptr, addr_len UInt32) Int64

/// Receive data and get sender address (UDP)
foreign let __koral_socket_recvfrom(fd Int64, buf UInt8 ptr, len UInt64, flags Int32, addr_out UInt8 ptr, addr_len_out UInt32 ptr) Int64

/// Shutdown a socket
foreign let __koral_socket_shutdown(fd Int64, how Int32) Int32

/// Set a socket option
foreign let __koral_socket_setsockopt(fd Int64, level Int32, optname Int32, optval UInt8 ptr, optlen UInt32) Int32

/// Get a socket option
foreign let __koral_socket_getsockopt(fd Int64, level Int32, optname Int32, optval UInt8 ptr, optlen UInt32 ptr) Int32

/// Get the local address of a socket
foreign let __koral_socket_getsockname(fd Int64, addr_out UInt8 ptr, addr_len_out UInt32 ptr) Int32

/// Get the peer address of a socket
foreign let __koral_socket_getpeername(fd Int64, addr_out UInt8 ptr, addr_len_out UInt32 ptr) Int32

// ============================================================================
// Platform-specific socket constants
// ============================================================================

/// SOL_SOCKET level for setsockopt/getsockopt
foreign let __koral_const_SOL_SOCKET() Int32

/// SO_REUSEADDR option
foreign let __koral_const_SO_REUSEADDR() Int32

/// SO_BROADCAST option
foreign let __koral_const_SO_BROADCAST() Int32

/// SO_RCVTIMEO option (receive timeout)
foreign let __koral_const_SO_RCVTIMEO() Int32

/// SO_SNDTIMEO option (send timeout)
foreign let __koral_const_SO_SNDTIMEO() Int32

/// IPPROTO_TCP level for TCP options
foreign let __koral_const_IPPROTO_TCP() Int32

/// TCP_NODELAY option
foreign let __koral_const_TCP_NODELAY() Int32

/// AF_INET address family
foreign let __koral_const_AF_INET() Int32

/// AF_INET6 address family
foreign let __koral_const_AF_INET6() Int32

/// SOCK_STREAM socket type
foreign let __koral_const_SOCK_STREAM() Int32

/// SOCK_DGRAM socket type
foreign let __koral_const_SOCK_DGRAM() Int32
