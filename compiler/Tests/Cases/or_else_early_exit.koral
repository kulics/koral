// Test or else early exit (return from block expression)
// EXPECT: Option Some path: 42
// EXPECT: Option None path: -1
// EXPECT: Result Ok path: 100
// EXPECT: Result Error path: -2
// EXPECT: Result error propagation: error_msg

let try_option(opt [Int]Option) Int = {
    let val = opt or else { return -1 }
    yield val
}

let try_result(res [Int]Result) Int = {
    let val = res or else { return -2 }
    yield val
}

let try_result_propagate(res [Int]Result) [Int]Result = {
    let val = res or else { return [Int]Result.Error(_) }
    yield [Int]Result.Ok(val * 2)
}

let main() Int = {
    // Option: Some path continues
    print("Option Some path: ")
    println(try_option([Int]Option.Some(42)))

    // Option: None path returns early
    print("Option None path: ")
    println(try_option([Int]Option.None()))

    // Result: Ok path continues
    print("Result Ok path: ")
    println(try_result([Int]Result.Ok(100)))

    // Result: Error path returns early
    print("Result Error path: ")
    println(try_result([Int]Result.Error(ref "err")))

    // Result: Error propagation with _ binding
    let propagated = try_result_propagate([Int]Result.Error(ref "error_msg"))
    print("Result error propagation: ")
    when propagated in {
        .Ok(v) then println(v.to_string()),
        .Error(e) then println(e.message()),
    }

    yield 0
}
