// Test or else early exit (return from block expression)
// EXPECT: Option Some path: 42
// EXPECT: Option None path: -1
// EXPECT: Result Ok path: 100
// EXPECT: Result Error path: -2
// EXPECT: Result error propagation: error_msg

let try_option(opt [Int]Option) Int = {
    let val = opt or else { return -1 }
    val
}

let try_result(res [Int, String]Result) Int = {
    let val = res or else { return -2 }
    val
}

let try_result_propagate(res [Int, String]Result) [Int, String]Result = {
    let val = res or else { return [Int, String]Result.Error(_) }
    [Int, String]Result.Ok(val * 2)
}

let main() Int = {
    // Option: Some path continues
    print("Option Some path: ")
    print_line(try_option([Int]Option.Some(42)))

    // Option: None path returns early
    print("Option None path: ")
    print_line(try_option([Int]Option.None()))

    // Result: Ok path continues
    print("Result Ok path: ")
    print_line(try_result([Int, String]Result.Ok(100)))

    // Result: Error path returns early
    print("Result Error path: ")
    print_line(try_result([Int, String]Result.Error("err")))

    // Result: Error propagation with _ binding
    let propagated = try_result_propagate([Int, String]Result.Error("error_msg"))
    print("Result error propagation: ")
    when propagated is {
        .Ok(v) then print_line(v.to_string()),
        .Error(e) then print_line(e),
    }

    0
}
