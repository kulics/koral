// Test drop of temporary values in string interpolation
// EXPECT: Creating Resource 1
// EXPECT: Drop Resource 1
// EXPECT: Result: Resource id=1
// EXPECT: Creating Resource 2
// EXPECT: Drop Resource 2
// EXPECT: Creating Resource 3
// EXPECT: Drop Resource 3
// EXPECT: Combined: 2 and 3
// EXPECT: All string interpolation drop tests passed

type Resource(id Int)

given Resource {
    __drop(self ref) Void = {
        print("Drop Resource ")
        print_line(self.id)
    }
    
    to_string(self) String = {
        "Resource id=" + self.id.to_string()
    }
}

let create_resource(id Int) Resource = {
    print("Creating Resource ")
    print_line(id)
    Resource(id)
}

let test_single_interpolation() Void = {
    // The Resource is created, converted to string, then dropped
    let s = "Result: \(create_resource(1))"
    print_line(s)
}

let test_multiple_interpolation() Void = {
    // Multiple Resources in one interpolation
    let s = "Combined: \(create_resource(2).id) and \(create_resource(3).id)"
    print_line(s)
}

let main() Int = {
    test_single_interpolation()
    test_multiple_interpolation()
    
    print_line("All string interpolation drop tests passed")
    0
}
