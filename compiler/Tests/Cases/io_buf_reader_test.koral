// EXPECT: All BufReader tests passed

using std.io.*

let main() Void = {
    // read
    let src1 = MemoryFile.from_string("hello world")
    let r1 = [MemoryFile]BufReader.new(src1)
    let mut out = make_bytes(64)
    when r1.read(ref out, ....) is {
        .Ok(_) then {},
        .Error(_) then assert(false, "read error"),
    }

    // read_byte
    let src2 = MemoryFile.from_string("ABC")
    let r2 = [MemoryFile]BufReader.new(src2)
    when r2.read_byte() is {
        .Ok(_) then {},
        .Error(_) then assert(false, "read_byte error"),
    }

    // read_until
    let src3 = MemoryFile.from_string("a|b|c")
    let r3 = [MemoryFile]BufReader.new(src3)
    let mut out2 = make_bytes(16)
    when r3.read_until(124, ref out2, ....) is {
        .Ok(_) then {},
        .Error(_) then assert(false, "read_until error"),
    }

    // read_line
    let src4 = MemoryFile.from_string("line1\nline2")
    let r4 = [MemoryFile]BufReader.new(src4)
    when r4.read_line() is {
        .Ok(_) then {},
        .Error(_) then assert(false, "read_line error"),
    }

    // skip
    let src5 = MemoryFile.from_string("abcdef")
    let r5 = [MemoryFile]BufReader.new(src5)
    when r5.skip(2) is {
        .Ok(_) then {},
        .Error(_) then assert(false, "skip error"),
    }

    println("All BufReader tests passed")
}
