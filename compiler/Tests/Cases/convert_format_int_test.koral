// std.convert integer formatting tests
// EXPECT: decimal_ok
// EXPECT: hex_ok
// EXPECT: hex_upper_ok
// EXPECT: bin_ok
// EXPECT: oct_ok
// EXPECT: prefix_hex_ok
// EXPECT: prefix_bin_ok
// EXPECT: sign_plus_ok
// EXPECT: width_right_ok
// EXPECT: width_left_ok
// EXPECT: width_center_ok
// EXPECT: zero_pad_ok
// EXPECT: grouping_comma_ok
// EXPECT: grouping_under_ok
// EXPECT: uint_hex_ok
// EXPECT: roundtrip_ok
// EXPECT: negative_ok

using std.convert

let main() Int = {
    // Decimal format
    if 42.format("d").equals("42") then print_line("decimal_ok")
    else print_line("FAIL decimal: " + 42.format("d"))

    // Hex lowercase
    if 255.format("x").equals("ff") then print_line("hex_ok")
    else print_line("FAIL hex: " + 255.format("x"))

    // Hex uppercase
    if 255.format("X").equals("FF") then print_line("hex_upper_ok")
    else print_line("FAIL hex_upper: " + 255.format("X"))

    // Binary
    if 10.format("b").equals("1010") then print_line("bin_ok")
    else print_line("FAIL bin: " + 10.format("b"))

    // Octal
    if 63.format("o").equals("77") then print_line("oct_ok")
    else print_line("FAIL oct: " + 63.format("o"))

    // Prefix hex
    if 255.format("#x").equals("0xff") then print_line("prefix_hex_ok")
    else print_line("FAIL prefix_hex: " + 255.format("#x"))

    // Prefix binary
    if 10.format("#b").equals("0b1010") then print_line("prefix_bin_ok")
    else print_line("FAIL prefix_bin: " + 10.format("#b"))

    // Sign +
    if 42.format("+d").equals("+42") then print_line("sign_plus_ok")
    else print_line("FAIL sign_plus: " + 42.format("+d"))

    // Width right-align (default)
    if 42.format("5d").equals("   42") then print_line("width_right_ok")
    else print_line("FAIL width_right: [" + 42.format("5d") + "]")

    // Width left-align
    if 42.format("<5d").equals("42   ") then print_line("width_left_ok")
    else print_line("FAIL width_left: [" + 42.format("<5d") + "]")

    // Width center-align
    if 42.format("^5d").equals(" 42  ") then print_line("width_center_ok")
    else print_line("FAIL width_center: [" + 42.format("^5d") + "]")

    // Zero padding
    if 42.format("05d").equals("00042") then print_line("zero_pad_ok")
    else print_line("FAIL zero_pad: [" + 42.format("05d") + "]")

    // Grouping comma
    if 1000000.format(",d").equals("1,000,000") then print_line("grouping_comma_ok")
    else print_line("FAIL grouping_comma: " + 1000000.format(",d"))

    // Grouping underscore
    if 1000000.format("_d").equals("1_000_000") then print_line("grouping_under_ok")
    else print_line("FAIL grouping_under: " + 1000000.format("_d"))

    // UInt hex
    let u UInt = 255
    if u.format("x").equals("ff") then print_line("uint_hex_ok")
    else print_line("FAIL uint_hex: " + u.format("x"))

    // Roundtrip: parse(format(n)) == n
    let n = 12345
    when Int.parse(n.format("d")) is {
        .Ok(parsed) then {
            if parsed == n then print_line("roundtrip_ok")
            else print_line("FAIL roundtrip")
        },
        .Error(e) then print_line("FAIL roundtrip: " + e.message()),
    }

    // Negative format
    let neg = 0 - 42
    if neg.format("d").equals("-42") then print_line("negative_ok")
    else print_line("FAIL negative: " + neg.format("d"))

    0
}
