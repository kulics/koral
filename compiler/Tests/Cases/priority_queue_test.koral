// EXPECT: All PriorityQueue tests passed

using * in "std/container"

let main() Void = {
    let mut pq = [Int]PriorityQueue.new()
    assert(pq.is_empty(), "new priority queue empty")

    pq.push(10)
    pq.push(3)
    pq.push(25)
    pq.push(7)

    assert(pq.count() == 4, "count after push")
    assert(pq.peek().unwrap() == 25, "peek max")

    let a = pq.pop().unwrap()
    let b = pq.pop().unwrap()
    let c = pq.pop().unwrap()
    let d = pq.pop().unwrap()
    assert(a == 25 and b == 10 and c == 7 and d == 3, "max-heap pop order")
    assert(pq.pop().is_none(), "pop empty")

    let mut original = [Int]PriorityQueue.new()
    original.push(5)
    original.push(9)

    let mut copy = original
    copy.push(20)
    let _ = copy.pop()
    copy.push(1)

    assert(original.count() == 2, "original count unchanged")
    assert(original.peek().unwrap() == 9, "original max unchanged")
    assert(copy.count() == 3, "copy count")
    assert(copy.peek().unwrap() == 9, "copy current max")

    let mut sum = 0
    for v in copy then {
        sum = sum + v
    }
    assert(sum == 15, "iterator snapshot sum")

    copy.clear()
    assert(copy.is_empty(), "clear works")
    assert(copy.peek().is_none(), "peek empty")

    println("All PriorityQueue tests passed")
}
