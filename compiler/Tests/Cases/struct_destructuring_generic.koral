// Test generic struct destructuring patterns
// EXPECT: test_generic_box: PASS
// EXPECT: test_generic_pair: PASS
// EXPECT: test_generic_nested: PASS
// EXPECT: test_generic_with_struct: PASS
// EXPECT: All generic struct destructuring tests passed!

type [T Any] Box(val T)
type [T Any, U Any] MyPair(first T, second U)
type Point(x Int, y Int)

// Test 1: Generic struct destructuring with Int
let test_generic_box() Int = {
    let b = [Int]Box(42)
    when b is {
        Box(v) then v,
    }
}

// Test 2: Generic pair destructuring
let test_generic_pair() Int = {
    let p = [Int, Int]MyPair(10, 20)
    when p is {
        MyPair(a, b) then a + b,
    }
}

// Test 3: Nested generic struct destructuring
let test_generic_nested() Int = {
    let b = [Int]Box(99)
    if b is Box(v) then v else 0
}

// Test 4: Generic struct containing a concrete struct
let test_generic_with_struct() Int = {
    let b = [Point]Box(Point(3, 4))
    when b is {
        Box(Point(x, y)) then x + y,
    }
}

let main() Int = {
    if test_generic_box() == 42 then {
        print_line("test_generic_box: PASS")
    } else {
        print_line("test_generic_box: FAIL")
        return 1
    }

    if test_generic_pair() == 30 then {
        print_line("test_generic_pair: PASS")
    } else {
        print_line("test_generic_pair: FAIL")
        return 1
    }

    if test_generic_nested() == 99 then {
        print_line("test_generic_nested: PASS")
    } else {
        print_line("test_generic_nested: FAIL")
        return 1
    }

    if test_generic_with_struct() == 7 then {
        print_line("test_generic_with_struct: PASS")
    } else {
        print_line("test_generic_with_struct: FAIL")
        return 1
    }

    print_line("All generic struct destructuring tests passed!")
    0
}
