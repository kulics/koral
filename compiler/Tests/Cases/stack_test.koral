// EXPECT: All Stack tests passed

using * in "std/container"

let main() Void = {
    let mut s = [Int]Stack.new()
    assert(s.is_empty(), "new stack empty")

    s.push(1)
    s.push(2)
    s.push(3)

    assert(s.count() == 3, "count after push")
    assert(s.peek().unwrap() == 3, "peek top")

    let p1 = s.pop()
    assert(p1.unwrap() == 3, "pop top")
    assert(s.peek().unwrap() == 2, "peek after pop")

    let mut it_count UInt = 0
    let mut first Int = 0
    let mut second Int = 0
    for v in s then {
        if it_count == 0 then {
            first = v
        }
        if it_count == 1 then {
            second = v
        }
        it_count += 1
    }
    assert(first == 2 and second == 1, "iterator from top to bottom")
    assert(it_count == 2, "iterator ends")

    let mut original = [Int]Stack.new()
    original.push(10)
    original.push(20)

    let mut copy = original
    copy.push(30)
    let _ = copy.pop()
    copy.push(99)

    assert(original.count() == 2, "original count unchanged")
    assert(original.peek().unwrap() == 20, "original top unchanged")
    assert(copy.count() == 3, "copy count")
    assert(copy.peek().unwrap() == 99, "copy top changed")

    s.clear()
    assert(s.is_empty(), "clear works")
    assert(s.pop().is_none(), "pop empty")
    assert(s.peek().is_none(), "peek empty")

    println("All Stack tests passed")
}
