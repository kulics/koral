// EXPECT: Start Value
// EXPECT: End Value
// EXPECT: Drop Tracker
// EXPECT: 1
// EXPECT: Start Ref
// EXPECT: End Ref
// EXPECT: Drop Tracker
// EXPECT: 3
// EXPECT: Start Scope
// EXPECT: Drop Tracker
// EXPECT: 2
// EXPECT: End Scope
// EXPECT: Start When
// EXPECT: Drop Tracker
// EXPECT: 42
// EXPECT: End When
// EXPECT: Start Unwrap
// EXPECT: Drop Tracker
// EXPECT: 99
// EXPECT: End Unwrap

public type Tracker(id Int)

given Tracker {
    __drop(self ref) = {
        print_line("Drop Tracker")
        print_line(self.id)
    }
}

let make_tracker(id Int) [Tracker]Result = [Tracker]Result.Ok(Tracker(id))

let test_value() Void = {
    print_line("Start Value")
    let t = Tracker(1)
    print_line("End Value")
}

let test_ref() Void = {
    print_line("Start Ref")
    let r = ref Tracker(3)
    print_line("End Ref")
}

let test_scope() Void = {
    print_line("Start Scope")
    if true then {
        let t = Tracker(2)
    } else {}
    print_line("End Scope")
}

let test_when_drop() Void = {
    print_line("Start When")
    when make_tracker(42) is {
        .Ok(t) then {
            let _ = t.id
        },
        .Error(_) then {},
    }
    print_line("End When")
}

let test_unwrap_drop() Void = {
    print_line("Start Unwrap")
    let _ = make_tracker(99).unwrap()
    print_line("End Unwrap")
}

public let main() Int = {
    test_value()
    test_ref()
    test_scope()
    test_when_drop()
    test_unwrap_drop()
    yield 0
}
