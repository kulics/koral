// EXPECT: env_set_get_ok
// EXPECT: remove_env_ok
// EXPECT: all_env_ok
// EXPECT: dirs_ok
// EXPECT: hostname_ok

using std.os.*

let main() Void = {
    // ========================================================================
    // Test 1: env / set_env roundtrip
    // ========================================================================
    set_env("KORAL_ENV_TEST_1", "value1").unwrap()
    let v = env("KORAL_ENV_TEST_1")
    assert(v.is_some(), "env is_some")
    assert(v.unwrap() == "value1", "env value")

    // Overwrite
    set_env("KORAL_ENV_TEST_1", "value2").unwrap()
    assert(env("KORAL_ENV_TEST_1").unwrap() == "value2", "env overwrite")

    // Non-existent
    assert(env("KORAL_NONEXISTENT_VAR_XYZ").is_none(), "env none")

    println("env_set_get_ok")

    // ========================================================================
    // Test 2: remove_env
    // ========================================================================
    set_env("KORAL_ENV_TEST_RM", "to_remove").unwrap()
    assert(env("KORAL_ENV_TEST_RM").is_some(), "before remove")
    remove_env("KORAL_ENV_TEST_RM").unwrap()
    assert(env("KORAL_ENV_TEST_RM").is_none(), "after remove")

    println("remove_env_ok")

    // ========================================================================
    // Test 3: all_env contains our test var
    // ========================================================================
    set_env("KORAL_ENV_TEST_ALL", "findme").unwrap()
    let envs = all_env()
    assert(envs.count() > 0, "all_env not empty")

    let mut found = false
    for pair in envs then {
        if pair.first == "KORAL_ENV_TEST_ALL" then {
            assert(pair.second == "findme", "all_env value")
            found = true
        }
    }
    assert(found, "all_env found test var")

    // Cleanup
    remove_env("KORAL_ENV_TEST_1").unwrap()
    remove_env("KORAL_ENV_TEST_ALL").unwrap()

    println("all_env_ok")

    // ========================================================================
    // Test 4: temp_dir, current_dir
    // ========================================================================
    let td = temp_dir()
    assert(not td.is_empty(), "temp_dir not empty")
    assert(is_dir(td), "temp_dir is_dir")

    let cd = current_dir().unwrap()
    assert(not cd.is_empty(), "current_dir not empty")
    assert(is_dir(cd), "current_dir is_dir")

    println("dirs_ok")

    // ========================================================================
    // Test 5: hostname
    // ========================================================================
    let hn = hostname().unwrap()
    assert(not hn.is_empty(), "hostname not empty")

    println("hostname_ok")
}
