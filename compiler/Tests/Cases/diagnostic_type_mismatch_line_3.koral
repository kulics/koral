// EXPECT-ERROR: diagnostic_type_mismatch_line_3.koral:26:17: error: Type mismatch: expected [UInt8]List, got String

let takes_bytes_3(bytes [UInt8]List) Void = {}

let choose_payload_3(flag Bool) String = {
    yield when flag is {
        true then "alpha",
        false then "beta",
    }
}

// Regression target #3:
// - when/match style branch with nested block
// - multiple statements and comments before failing call
let main() Void = {
    let mut tag = true
    let selected = choose_payload_3(tag)

    when selected.count() > 0 is {
        true then {
            let mut step UInt = 0
            step += 1

            {
                // takes_bytes_3 expects [UInt8]List, but selected is String
                takes_bytes_3(selected)
            }
        },
        false then {},
    }
}
