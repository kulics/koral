// Tests for generic types and functions
// Combines: basic generic types, generic functions, pairs, and copy semantics

// === Basic Generic Type Tests ===
// EXPECT: 1
// EXPECT: hello
// EXPECT: 42

// === Generic Function Tests ===
// EXPECT: 42
// EXPECT: hello
// EXPECT: 10
// EXPECT: 20

// === Generic Pair Tests ===
// EXPECT: 1
// EXPECT: hello
// EXPECT: world
// EXPECT: 2

// === Generic Copy Tests ===
// EXPECT: 100
// EXPECT: 100
// EXPECT: 10
// EXPECT: 20
// EXPECT: 123
// EXPECT: 123

// ============================================================
// Generic Types
// ============================================================

// Simple generic box type
type [T Any] Box(val T)

// Generic pair with two type parameters
type [T Any, U Any] TestPair(first T, second U)

// Point type for copy testing
type Point(x Int, y Int)

// ============================================================
// Generic Functions
// ============================================================

// Identity function
let [T Any] identity(x T) T = x

// Create a pair from two values of the same type
let [T Any] makePair(a T, b T) [T, T]TestPair = {
    yield [T, T]TestPair(a, b)
}

// Duplicate a value into a pair
let [T Any] duplicate(x T) [T, T]TestPair = {
    yield [T, T]TestPair(x, x)
}

// ============================================================
// Main function - runs all tests
// ============================================================

let main() = {
    // --- Basic Generic Type Tests ---
    
    // Box with Int
    let b1 = [Int]Box(1)
    print_line(b1.val)
    
    // Box with String
    let b2 = [String]Box("hello")
    print_line(b2.val)
    
    // Box with reference type
    let r = ref 42
    let b3 = [Int ref]Box(r)
    print_line(deref b3.val)
    
    // --- Generic Function Tests ---
    
    // Identity with Int
    print_line(identity(42))
    
    // Identity with String
    print_line(identity("hello"))
    
    // makePair function
    let p = makePair(10, 20)
    print_line(p.first)
    print_line(p.second)
    
    // --- Generic Pair Tests ---
    
    // Pair with Int and String
    let pair1 = [Int, String]TestPair(1, "hello")
    print_line(pair1.first)
    print_line(pair1.second)
    
    // Pair with String and Int (reversed)
    let pair2 = [String, Int]TestPair("world", 2)
    print_line(pair2.first)
    print_line(pair2.second)
    
    // --- Generic Copy Tests ---
    
    // Duplicate primitive
    let dup1 = duplicate(100)
    print_line(dup1.first)
    print_line(dup1.second)
    
    // Duplicate struct
    let pt = Point(10, 20)
    let dup2 = duplicate(pt)
    print_line(dup2.first.x)
    print_line(dup2.second.y)
    
    // Duplicate reference
    let r2 = ref 123
    let dup3 = duplicate(r2)
    print_line(deref dup3.first)
    print_line(deref dup3.second)
}
