// EXPECT: Heap Allocation Test:
// EXPECT: heapInt:
// EXPECT: 42
// EXPECT: heapPoint.x:
// EXPECT: 100
// EXPECT: heapPoint.y:
// EXPECT: 200
// EXPECT: sum:
// EXPECT: 300

type Point(x Int, y Int)

given Point {
    getX(self ref) Int = self.x
}

let testHeapAllocation() Int = {
    // Test heap allocation for primitive type
    let heapInt Int ref = ref 42
    
    // Test heap allocation for struct type
    let heapPoint Point ref = ref Point(100, 200)
    
    // Access heap allocated values
    // Dereference is implicit for member access
    let sum = heapPoint.x + heapPoint.y
    
    // Pass heap reference to function expecting ref
    let x = heapPoint.getX()
    
    println("Heap Allocation Test:")
    println("heapInt:")
    println(deref heapInt)
    
    println("heapPoint.x:")
    println(heapPoint.x)
    println("heapPoint.y:")
    println(heapPoint.y)
    println("sum:")
    println(sum)
    
    yield sum + x
}

let main() Int = {
    testHeapAllocation()
    yield 0
}
