// EXPECT: Heap Allocation Test:
// EXPECT: heapInt:
// EXPECT: 42
// EXPECT: heapPoint.x:
// EXPECT: 100
// EXPECT: heapPoint.y:
// EXPECT: 200
// EXPECT: sum:
// EXPECT: 300

type Point(x Int, y Int);

given Point {
    getX(self Point ref) Int = self.x;
};

let testHeapAllocation() Int = {
    // Test heap allocation for primitive type
    let heapInt Int ref = ref 42;
    
    // Test heap allocation for struct type
    let heapPoint Point ref = ref Point(100, 200);
    
    // Access heap allocated values
    // Dereference is implicit for member access
    let sum = heapPoint.x + heapPoint.y; 
    
    // Pass heap reference to function expecting ref
    let x = heapPoint.getX();
    
    printString("Heap Allocation Test:");
    printString("heapInt:");
    printInt(heapInt.copy());
    
    printString("heapPoint.x:");
    printInt(heapPoint.x);
    printString("heapPoint.y:");
    printInt(heapPoint.y);
    printString("sum:");
    printInt(sum);
    
    sum + x
};

let main() Int = {
    testHeapAllocation();
    0
}
