// Test defer error diagnostics
// Tests that the compiler correctly rejects return inside defer expression
// Also verifies that Lambda inside defer can contain control flow/defer (independent scope)
// EXPECT-ERROR: control flow statement 'return' is not allowed in defer expression

// Valid: Lambda inside defer can contain return and defer
// Lambda creates an independent scope, so insideDefer is reset
let valid_lambda_in_defer() Int = {
    defer {
        let f [Int]Func = () -> {
            defer println("lambda defer ok")
            return 1
        }
        f()
    }
    yield 0
}

// Error: return directly inside defer is not allowed
let error_return_in_defer() Int = {
    defer {
        return
    }
    yield 0
}

public let main() Int = {
    yield 0
}
