// Test trait object weakref support (downgrade and upgrade)
// EXPECT: hello
// EXPECT: upgrade succeeded

trait Greet {
    greet(self) String
}

type Greeter(name String)

given Greeter {
    public greet(self) String = self.name
}

let main() Int = {
    let g1 = ref Greeter("hello")
    let g Greet ref = g1
    print_line(g.greet())

    // Downgrade to weakref
    let w Greet weakref = downgrade_ref(g)

    // Upgrade back to strong ref
    let upgraded = upgrade_ref(w)
    when upgraded is {
        .Some(s) then print_line("upgrade succeeded"),
        .None then print_line("upgrade failed"),
    }

    yield 0
}
