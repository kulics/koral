// Test or else / and then precedence and associativity
// EXPECT: and_then higher than or_else: 10
// EXPECT: chain left assoc: 9
// EXPECT: or_else basic Some: 42
// EXPECT: or_else basic None: 0
// EXPECT: and_then basic Some: 84
// EXPECT: and_then basic None: None
// EXPECT: mixed chain: 99

let print_option(label String, opt [Int]Option) Void = {
    print(label)
    when opt is {
        .Some(v) then print_line(v.to_string()),
        .None then print_line("None"),
    }
}

let main() Int = {
    // and then binds tighter than or else:
    // `opt and then _ * 2 or else 10` parses as `(opt and then _ * 2) or else 10`
    let opt_none = [Int]Option.None()
    let r1 = opt_none and then _ * 2 or else 10
    print("and_then higher than or_else: ")
    print_line(r1)

    // Chain left-to-right: a and then _ + 1 and then _ * 3
    // = ((a and then _ + 1) and then _ * 3)
    // Some(2) -> Some(3) -> Some(9)
    let opt2 = [Int]Option.Some(2)
    let r2 = opt2 and then _ + 1 and then _ * 3
    print_option("chain left assoc: ", r2)

    // Basic or else
    let opt_some = [Int]Option.Some(42)
    let r3 = opt_some or else 0
    print("or_else basic Some: ")
    print_line(r3)

    let r4 = opt_none or else 0
    print("or_else basic None: ")
    print_line(r4)

    // Basic and then
    let r5 = opt_some and then _ * 2
    print_option("and_then basic Some: ", r5)

    let r6 = opt_none and then _ * 2
    print_option("and_then basic None: ", r6)

    // Mixed chain: opt and then _ * 3 or else 0
    // Some(33) -> and then -> Some(99) -> or else -> 99
    let opt3 = [Int]Option.Some(33)
    let r7 = opt3 and then _ * 3 or else 0
    print("mixed chain: ")
    print_line(r7)

    0
}
