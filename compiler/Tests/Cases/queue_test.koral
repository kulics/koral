// EXPECT: All Queue tests passed

using * in "std/container"

let main() Void = {
    let mut q = [Int]Queue.new()
    assert(q.is_empty(), "new queue empty")

    q.push(1)
    q.push(2)
    q.push(3)

    assert(q.count() == 3, "count after push")
    assert(q.peek().unwrap() == 1, "peek front")

    let p1 = q.pop()
    assert(p1.unwrap() == 1, "pop first")
    assert(q.peek().unwrap() == 2, "peek after pop")

    q.push(4)
    let mut iter_count UInt = 0
    for v in q then {
        when iter_count in {
            0 then assert(v == 2, "iter first"),
            1 then assert(v == 3, "iter second"),
            2 then assert(v == 4, "iter third"),
            _ then assert(false, "iter end"),
        }
        iter_count += 1
    }
    assert(iter_count == 3, "iter end")

    let mut original = [Int]Queue.new()
    original.push(10)
    original.push(20)

    let mut copy = original
    let _ = copy.pop()
    copy.push(30)

    assert(original.count() == 2, "original count unchanged")
    assert(original.peek().unwrap() == 10, "original front unchanged")
    assert(copy.count() == 2, "copy count")
    assert(copy.peek().unwrap() == 20, "copy front changed")

    q.clear()
    assert(q.is_empty(), "clear works")
    assert(q.pop().is_none(), "pop empty")
    assert(q.peek().is_none(), "peek empty")

    println("All Queue tests passed")
}
