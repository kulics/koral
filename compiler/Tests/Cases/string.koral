// EXPECT: String tests passed

let test_literal_basics() Void = {
    let s = "hi"
    let h UInt8 = 104
    let i UInt8 = 105
    assert(s.count() == 2, "literal count")
    assert(not s.is_empty(), "literal not empty")
    assert(s[0] == h, "literal byte h")
    assert(s[1] == i, "literal byte i")
    // Test safe get method
    when s.get(0) is {
        .Some(b) then assert(b == h, "get byte h"),
        .None then panic("get should return Some"),
    }
    when s.get(100) is {
        .Some(_) then panic("get out of bounds should return None"),
        .None then {},
    }
}

let test_push() Void = {
    let mut s = "a"
    let b UInt8 = 98// 'b'
    s.push(b)
    assert(s.count() == 2, "push count")
    assert(s[1] == b, "push byte")
}

let test_push_string() Void = {
    let mut s = "ab"
    let t = "XYZ"
    let z UInt8 = 90// 'Z'
    s.push_string(t)
    assert(s.count() == 5, "push string count")
    assert(s[4] == z, "push string byte")
}

let test_push_int() Void = {
    let mut s = "value: "
    s.push_int(42)
    assert(s == "value: 42", "push_int")
}

let test_push_uint() Void = {
    let mut s = "count: "
    s.push_uint(100u)
    assert(s == "count: 100", "push_uint")
}

let test_push_bool() Void = {
    let mut s = "flag: "
    s.push_bool(true)
    assert(s == "flag: true", "push_bool true")
    
    let mut s2 = "flag: "
    s2.push_bool(false)
    assert(s2 == "flag: false", "push_bool false")
}

let test_copy_on_write() Void = {
    let mut a = "hi"
    let b = a// Copy should share storage
    let bang UInt8 = 33// '!'
    let h UInt8 = 104// 'h'

    a.push(bang)

    assert(a.count() == 3, "a mutated count")
    assert(a[2] == bang, "a mutated byte")

    // Original copy remains unchanged
    assert(b.count() == 2, "b preserved count")
    assert(b[0] == h, "b preserved byte")
}

let main() Void = {
    test_literal_basics()
    test_push()
    test_push_string()
    test_push_int()
    test_push_uint()
    test_push_bool()
    test_copy_on_write()
    print_line("String tests passed")
}
