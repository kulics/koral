// EXPECT: All List sort tests passed

let main() Void = {
    // === Test 1: Empty list sort ===
    let mut empty = [Int]List.new()
    empty.sort()
    assert(empty.count() == 0, "empty list sort")

    // === Test 2: Single element sort ===
    let mut single = [Int]List.new()
    single.push_back(42)
    single.sort()
    assert(single.count() == 1, "single element count")
    assert(single[0] == 42, "single element value")

    // === Test 3: Two elements sort ===
    let mut two = [Int]List.new()
    two.push_back(5)
    two.push_back(3)
    two.sort()
    assert(two[0] == 3, "two elements: first")
    assert(two[1] == 5, "two elements: second")

    // === Test 4: Already sorted list ===
    let mut sorted = [Int]List.new()
    sorted.push_back(1)
    sorted.push_back(2)
    sorted.push_back(3)
    sorted.sort()
    assert(sorted[0] == 1 and sorted[1] == 2 and sorted[2] == 3, "already sorted")

    // === Test 5: Reverse sorted list ===
    let mut reverse = [Int]List.new()
    reverse.push_back(5)
    reverse.push_back(4)
    reverse.push_back(3)
    reverse.push_back(2)
    reverse.push_back(1)
    reverse.sort()
    assert(reverse[0] == 1, "reverse: 0")
    assert(reverse[1] == 2, "reverse: 1")
    assert(reverse[2] == 3, "reverse: 2")
    assert(reverse[3] == 4, "reverse: 3")
    assert(reverse[4] == 5, "reverse: 4")

    // === Test 6: Random order with duplicates ===
    let mut random = [Int]List.new()
    random.push_back(3)
    random.push_back(1)
    random.push_back(4)
    random.push_back(1)
    random.push_back(5)
    random.push_back(9)
    random.push_back(2)
    random.push_back(6)
    random.sort()
    assert(random[0] == 1, "random: 0")
    assert(random[1] == 1, "random: 1")
    assert(random[2] == 2, "random: 2")
    assert(random[3] == 3, "random: 3")
    assert(random[4] == 4, "random: 4")
    assert(random[5] == 5, "random: 5")
    assert(random[6] == 6, "random: 6")
    assert(random[7] == 9, "random: 7")

    // === Test 7: sort_by descending ===
    let mut desc = [Int]List.new()
    desc.push_back(1)
    desc.push_back(5)
    desc.push_back(3)
    desc.push_back(2)
    desc.push_back(4)
    // Descending: if a > b, a should come first (return negative)
    desc.sort_by((a, b) -> if a > b then 0 - 1 else if a < b then 1 else 0)
    assert(desc[0] == 5, "desc: 0")
    assert(desc[1] == 4, "desc: 1")
    assert(desc[2] == 3, "desc: 2")
    assert(desc[3] == 2, "desc: 3")
    assert(desc[4] == 1, "desc: 4")

    // === Test 8: sort_by with custom comparator ===
    let mut custom = [Int]List.new()
    custom.push_back(10)
    custom.push_back(3)
    custom.push_back(7)
    custom.push_back(1)
    // Sort by absolute difference from 5
    custom.sort_by((a, b) -> {
        let diff_a = if a > 5 then a - 5 else 5 - a
        let diff_b = if b > 5 then b - 5 else 5 - b
        if diff_a < diff_b then 0 - 1 else if diff_a > diff_b then 1 else 0
    })
    // Expected order by diff from 5: 3 (diff=2), 7 (diff=2), 1 (diff=4), 10 (diff=5)
    assert(custom[0] == 3 or custom[0] == 7, "custom: closest to 5")
    assert(custom[3] == 10, "custom: farthest from 5")

    // === Test 9: Copy-on-Write with sort ===
    let mut original = [Int]List.new()
    original.push_back(3)
    original.push_back(1)
    original.push_back(2)
    
    let mut copy = original  // Shallow copy
    copy.sort()  // Should trigger COW
    
    // Original unchanged
    assert(original[0] == 3, "COW: original[0]")
    assert(original[1] == 1, "COW: original[1]")
    assert(original[2] == 2, "COW: original[2]")
    
    // Copy sorted
    assert(copy[0] == 1, "COW: copy[0]")
    assert(copy[1] == 2, "COW: copy[1]")
    assert(copy[2] == 3, "COW: copy[2]")

    // === Test 10: Idempotency ===
    let mut idem = [Int]List.new()
    idem.push_back(2)
    idem.push_back(1)
    idem.push_back(3)
    idem.sort()
    let first_0 = idem[0]
    let first_1 = idem[1]
    let first_2 = idem[2]
    idem.sort()  // Sort again
    assert(idem[0] == first_0 and idem[1] == first_1 and idem[2] == first_2, "idempotency")

    print_line("All List sort tests passed")
}
