// EXPECT: args_ok
// EXPECT: command_result_ok
// EXPECT: run_command_ok

using std.os.*

let main() Void = {
    // ========================================================================
    // args() — should return at least the executable path
    // ========================================================================
    let arg_list = args()
    assert(arg_list.count() >= 1, "args count")

    print_line("args_ok")

    // ========================================================================
    // CommandResult type
    // ========================================================================
    let cr = CommandResult(0, "out", "err")
    assert(cr.is_success(), "CommandResult is_success")
    assert(cr.code == 0, "CommandResult code")
    assert(cr.stdout == "out", "CommandResult stdout")
    assert(cr.stderr == "err", "CommandResult stderr")
    let s = cr.to_string()
    assert(s.contains("CommandResult"), "CommandResult to_string")
    assert(s.contains("code=0"), "CommandResult to_string code")

    let cr_fail = CommandResult(1, "", "")
    assert(not cr_fail.is_success(), "CommandResult not success")

    print_line("command_result_ok")

    // ========================================================================
    // run_command — best effort (echo should work on all platforms)
    // ========================================================================
    let mut cmd_args = [String]List.new()
    cmd_args.push("hello_koral")
    when run_command("echo", cmd_args) is {
        .Ok(result) then {
            assert(result.stdout.contains("hello_koral"), "run_command stdout")
        },
        .Error(_) then {},
    }

    print_line("run_command_ok")
}
