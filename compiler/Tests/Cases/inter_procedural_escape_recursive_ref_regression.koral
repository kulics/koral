// Regression: recursive receiver type with List.push(ref value) must compile/run (no monomorphization crash)
// EXPECT: recursive_ref_push_regression: ok

public type Node {
    Leaf(value Int),
    Branch(children [Node ref]List),
}

let main() Void = {
    let mut kids = [Node ref]List.new()
    let leaf = Node.Leaf(10)
    kids.push(ref leaf)

    let tree = Node.Branch(kids)
    when tree in {
        .Branch(ch) then {
            let n = deref ch[0]
            when n in {
                .Leaf(v) then {
                    if v == 10 then {
                        println("recursive_ref_push_regression: ok")
                    } else {
                        panic("unexpected leaf value")
                    }
                },
                _ then panic("unexpected node kind"),
            }
        },
        _ then panic("unexpected tree kind"),
    }
}
