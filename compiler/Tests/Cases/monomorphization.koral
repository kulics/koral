// Tests for monomorphization functionality
// Combines: basic instantiation, caching, and transitive instantiation

// === Basic Monomorphization Tests ===
// EXPECT: 42
// EXPECT: hello
// EXPECT: true

// === Caching Tests ===
// EXPECT: 10
// EXPECT: 20
// EXPECT: 30

// === Transitive Monomorphization Tests ===
// EXPECT: 42
// EXPECT: true

// ============================================================
// Test 1: Generic function instantiation with different types
// ============================================================

let [T Any]identity(x T) T = x

// ============================================================
// Test 2: Generic struct instantiation
// ============================================================

type [T Any]Wrapper(inner T)

// ============================================================
// Test 3: Caching - same instantiation should be reused
// ============================================================

// Generic function that should be instantiated only once for Int
let [T Any]double_value(x T, y T) T = x

// ============================================================
// Test 4: Transitive monomorphization - nested generic types
// ============================================================

// Generic pair type that uses Wrapper
type [T Any]WrappedPair(first [T]Wrapper, second [T]Wrapper)

// ============================================================
// Main function - runs all tests
// ============================================================

let main() Int = {
    // --- Basic Monomorphization Tests ---
    
    // Test identity with Int
    let a = identity(42)
    print_line(a)
    
    // Test identity with String
    let b = identity("hello")
    print_line(b)
    
    // Test identity with Bool
    let c = identity(true)
    print_line(c)
    
    // --- Caching Tests ---
    
    // Multiple calls with same type should use cached instantiation
    let d = double_value(10, 1)
    let e = double_value(20, 2)
    let f = double_value(30, 3)
    
    print_line(d)
    print_line(e)
    print_line(f)
    
    // --- Transitive Monomorphization Tests ---
    
    // Create nested generic types
    let w1 = [Int]Wrapper(42)
    let w2 = [Int]Wrapper(100)
    let pair = [Int]WrappedPair(w1, w2)
    
    // Access nested value
    print_line(pair.first.inner)
    
    // Test with Bool
    let bw = [Bool]Wrapper(true)
    print_line(bw.inner)
    
    0
}
