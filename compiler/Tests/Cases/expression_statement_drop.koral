// Test drop of unused return values in expression statements
// EXPECT: Creating Resource 1
// EXPECT: Drop Resource 1
// EXPECT: Creating Resource 2
// EXPECT: Drop Resource 2
// EXPECT: Creating Resource 3
// EXPECT: Drop Resource 3
// EXPECT: Void function called
// EXPECT: All expression statement drop tests passed

type Resource(id Int)

given Resource {
    __drop(self ref) Void = {
        print("Drop Resource ")
        println(self.id)
    }
}

// Function that returns a Resource
let create_resource(id Int) Resource = {
    print("Creating Resource ")
    println(id)
    yield Resource(id)
}

// Void function - should not generate drop
let void_function() Void = {
    println("Void function called")
}

// Method that returns a Resource
type Factory()

given Factory {
    make(self ref, id Int) Resource = {
        yield create_resource(id)
    }
}

let main() Int = {
    // Test 1: Function call return value unused - should drop
    create_resource(1)
    
    // Test 2: Method call return value unused - should drop
    let f = Factory()
    f.make(2)
    
    // Test 3: Chained expression result unused - should drop
    create_resource(3)
    
    // Test 4: Void function - should NOT generate drop
    void_function()
    
    println("All expression statement drop tests passed")
    yield 0
}
