// EXPECT: peek:
// EXPECT: 42
// EXPECT: offset:
// EXPECT: 100
// EXPECT: take:
// EXPECT: 100
// EXPECT: replace:
// EXPECT: 200
// EXPECT: (old:
// EXPECT: 999
// EXPECT: )
// EXPECT: false

let main() Int = {
    // Alloc 2 ints
    // Explicit generic call
    let p = [Int]alloc_memory(2)

    // Init first
    init_memory(p, 42)
    
    // Peek
    let val = deptr p
    print_line("peek:")
    print_line(val)
    
    // Offset
    let ptr2 = offset_ptr(p, 1)
    init_memory(ptr2, 100)
    print_line("offset:")
    print_line(deptr ptr2)
    
    // Take
    let val2 = take_memory(ptr2)
    print_line("take:")
    print_line(val2)
    
    // Replace
    // ptr is initialized.
    deptr p = 999
    
    let old = deptr p
    deptr p = 200
    print_line("replace:")
    print_line(deptr p)
    print_line("(old:")
    print_line(old)
    print_line(")")
    
    // Infer generic type [Int] for dealloc
    dealloc_memory(p)

    // Test null_ptr
    print_line(p == null_ptr())

    0
}
