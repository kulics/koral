// EXPECT: peek: 42
// EXPECT: offset: 100
// EXPECT: take: 100
// EXPECT: replace: 200 (old: 999)

let main() Int = {
    // Alloc 2 ints
    // Explicit generic call
    let ptr = [Int]alloc_memory(2);
    
    // Init first
    ptr.init(42);
    
    // Peek
    let val = ptr.peek();
    print_string("peek:");
    print_int(deref val);
    
    // Offset
    let ptr2 = ptr.offset(1);
    ptr2.init(100);
    print_string("offset:");
    print_int(deref ptr2.peek());
    
    // Take
    let val2 = ptr2.take();
    print_string("take:");
    print_int(val2);
    
    // Replace
    // ptr is initialized.
    ptr.replace(999);
    
    let old = ptr.replace(200);
    print_string("replace:");
    print_int(deref ptr.peek());
    print_string("(old:");
    print_int(old);
    print_string(")");
    
    // Infer generic type [Int] for dealloc
    dealloc_memory(ptr);
    0
}
