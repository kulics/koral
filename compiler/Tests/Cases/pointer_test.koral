// EXPECT: peek:
// EXPECT: 42
// EXPECT: offset:
// EXPECT: 100
// EXPECT: take:
// EXPECT: 100
// EXPECT: replace:
// EXPECT: 200
// EXPECT: (old:
// EXPECT: 999
// EXPECT: )

let main() Int = {
    // Alloc 2 ints
    // Explicit generic call
    let ptr = [Int]alloc_memory(2)
    
    // Init first
    ptr.init(42)
    
    // Peek
    let val = ptr.peek()
    print_string("peek:")
    print_int(val)
    
    // Offset
    let ptr2 = ptr.offset(1)
    ptr2.init(100)
    print_string("offset:")
    print_int(ptr2.peek())
    
    // Take
    let val2 = ptr2.take()
    print_string("take:")
    print_int(val2)
    
    // Replace
    // ptr is initialized.
    ptr.replace(999)
    
    let old = ptr.replace(200)
    print_string("replace:")
    print_int(ptr.peek())
    print_string("(old:")
    print_int(old)
    print_string(")")
    
    // Infer generic type [Int] for dealloc
    dealloc_memory(ptr)
    0
}
