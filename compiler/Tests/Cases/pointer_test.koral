// EXPECT: peek:
// EXPECT: 42
// EXPECT: offset:
// EXPECT: 100
// EXPECT: take:
// EXPECT: 100
// EXPECT: replace:
// EXPECT: 200
// EXPECT: (old:
// EXPECT: 999
// EXPECT: )
// EXPECT: false

let main() Int = {
    // Alloc 2 ints
    // Explicit generic call
    let p = [Int]alloc_memory(2)

    // Init first
    init_memory(p, 42)
    
    // Peek
    let val = deptr p
    println("peek:")
    println(val)
    
    // Offset
    let ptr2 = p + 1
    init_memory(ptr2, 100)
    println("offset:")
    println(deptr ptr2)
    
    // Take
    let val2 = take_memory(ptr2)
    println("take:")
    println(val2)
    
    // Replace
    // ptr is initialized.
    deptr p = 999
    
    let old = deptr p
    deptr p = 200
    println("replace:")
    println(deptr p)
    println("(old:")
    println(old)
    println(")")
    
    // Infer generic type [Int] for dealloc
    dealloc_memory(p)

    // Test null_ptr
    println(p == null_ptr())

    yield 0
}
